---
title: "Role Management in Swig"
description: "How to use role management utilities in Swig for advanced permissioning and authority control."
---

# Role Management in Swig

Swig wallets support advanced role-based access control. Each Swig can have multiple roles, each with its own authority and permissions. The Swig TypeScript SDK provides utilities to query, filter, and manage these roles programmatically.

## What is a Role?

A **Role** in Swig represents a set of permissions (actions) granted to a specific authority (public key or session key). Each role is uniquely identified by a role ID and is associated with:
- **Authority**: The entity (public key, session key, or EVM address) that controls the role.
- **Actions**: The permissions or capabilities granted to the authority (e.g., spend SOL, manage authorities, sign transactions).
- **Role ID**: A unique number for referencing the role in instructions.
- **Authority Type**: The cryptographic type (Ed25519, Secp256k1, session, etc.).

Roles enable fine-grained, multi-user, and multi-device access control for Swig wallets.

## Role Structure

```typescript
class Role {
  readonly swigAddress: SolPublicKey;
  readonly authority: Authority; // Ed25519, Secp256k1, Session, etc.
  readonly actions: Actions;     // Permissions for this role
  readonly swigId: Uint8Array;
  // ...
  get id(): number;             // Unique role ID
  get authorityType(): AuthorityType;
  isSessionBased(): boolean;
  isTokenBased(): boolean;
}
```

- **authority**: The cryptographic identity (public key, session key, etc.)
- **actions**: Permissions (e.g., can spend SOL, manage authorities, sign, etc.)
- **id**: Used to reference the role in all Swig instructions

## Why Use Role Management?

- **Multi-user wallets**: Assign different permissions to different users/devices
- **Session keys**: Grant temporary, limited access for dApps or automation
- **dApp integrations**: Allow dApps to act on behalf of users with restricted permissions
- **Auditing**: List and inspect all authorities and their capabilities

## Main APIs for Role Management

- `swig.roles`: Array of all roles on the Swig
- `swig.findRoleById(id)`
- `swig.findRoleBySessionKey(sessionKey)`
- `swig.findRolesByAuthoritySigner(signerBytes)`
- `swig.findRolesByEd25519SignerPk(publicKey)`
- `swig.findRolesBySecp256k1SignerAddress(address)`

## Example: Listing All Roles

```typescript
const swig = await fetchSwig(connection, swigAddress);

for (const role of swig.roles) {
  console.log('---');
  console.log(`Role ID: ${role.id}`);
  console.log(`Authority Type: ${role.authorityType}`);
  console.log(`Is Session Based: ${role.isSessionBased()}`);
  console.log(`Is Token Based: ${role.isTokenBased()}`);
  console.log('Authority:', role.authority);
  console.log('Actions:', role.actions);
}
```

## Example: Find Role by ID and Use in Instructions

```typescript
const role = swig.findRoleById(0); // Find the root role
if (!role) throw new Error('Role not found');

// Use the role ID in an instruction
const signIx = await getSignInstructions(swig, role.id, [transferIx]);
```

## Example: Find Role by Session Key

```typescript
const sessionRole = swig.findRoleBySessionKey(sessionKeyPublicKey);
if (!sessionRole) {
  throw new Error('Session role not found');
}
console.log('Session role found:', sessionRole.id);
```

## Example: Find Roles by Authority Signer

```typescript
const roles = swig.findRolesByAuthoritySigner(signerPublicKeyBytes);
if (roles.length === 0) {
  console.warn('No roles found for this signer');
}
for (const role of roles) {
  console.log('Role with this signer:', role.id);
}
```

## Example: Find Roles by Ed25519 or Secp256k1 Signer

```typescript
const edRoles = swig.findRolesByEd25519SignerPk(ed25519PublicKey);
const secpRoles = swig.findRolesBySecp256k1SignerAddress(secp256k1Address);
```

## Checking Permissions for a Role

```typescript
const role = swig.findRoleById(1);
if (!role) throw new Error('Role not found');

if (role.actions.canSpendSol(BigInt(1_000_000))) {
  console.log('This role can spend at least 0.001 SOL');
}
if (role.actions.canSpendToken(tokenMint, BigInt(10_000_000))) {
  console.log('This role can spend at least 10 tokens');
}
if (role.actions.canManageAuthority()) {
  console.log('This role can add/remove authorities');
}
```

## Common Use Cases

- **Session Keys**: Grant a dApp or device temporary access to sign transactions for a limited time.
- **Multi-User Wallets**: Assign different spending limits or permissions to different users (e.g., family, team, DAO).
- **Automated Agents**: Give bots or scripts a role with limited permissions (e.g., only able to transfer a small amount).
- **dApp Integrations**: Let a dApp act on behalf of a user, but only for specific actions or tokens.

## Error Handling & Troubleshooting

- **Role Not Found**: Always check if `findRoleById` or similar calls return a valid role before using it.
- **Authority Mismatch**: If a transaction fails, ensure the authority (public key/session key) matches the role's authority.
- **Permission Denied**: Use `role.actions` to verify the role has the required permission before building or sending instructions.
- **Multiple Roles for Same Authority**: It's possible for one authority to have multiple roles (with different permissions). Use filtering to select the correct one.

## Advanced: Filtering Roles by Permission

```typescript
const canSpendSolRoles = swig.roles.filter(role => role.actions.canSpendSol(BigInt(1_000_000)));
for (const role of canSpendSolRoles) {
  console.log('Role that can spend SOL:', role.id);
}

const canManageAuthorityRoles = swig.roles.filter(role => role.actions.canManageAuthority());
for (const role of canManageAuthorityRoles) {
  console.log('Role that can manage authorities:', role.id);
}
```

## FAQ

**Q: Can a single authority have multiple roles?**
A: Yes. An authority (public key or session key) can be assigned multiple roles, each with different permissions.

**Q: How do I revoke a role?**
A: Use the `getRemoveAuthorityInstructions` or similar API, passing the role ID to remove.

**Q: What happens if a role's permissions are changed?**
A: The role's actions are updated on-chain. Always refetch the Swig to get the latest state.

**Q: How do I audit all authorities and their permissions?**
A: Iterate over `swig.roles` and inspect each role's authority and actions.

## Summary

Role management utilities in Swig make it easy to build secure, flexible, and auditable permission systems for your dApps. Use these APIs to query, filter, and manage authorities and their capabilities. 